\section{Virtual memory}
\index{virtual memory}

In the good old days of the 8-bit microcomputers programs ran one at a time and
each one could access any part of the memory. Memory ranges were subdivided into
ROM (Read-Only Memory), RAM (Random-Access Memory), video memory, device memory
and various system-defined ranges (for example the
\href{https://worldofspectrum.org/ZXSpectrum128+3Manual/chapter8pt24.html}{Spectrum
  128} \autocite{spectrum128-manual:c8pt24}) and each program simply had to know
where they could and could not write to.\\

This poses problems -- even if you run one program at a time a bug might result in
you overwriting critical system state causing unexpected behaviour and most
likely a crash, necessitating a system restart. If you run more than one program
at once then you enter a world of pain -- each program will need to somehow be
able to determine what parts of memory it can and cannot access, while
simultaneously being able to trample all over the data of both the system and
any other program. A single bug and you kill the system.\\

What is termed \emph{fragmentation} is also a huge problem in this scenario --
every block of memory allocated by the operating system must sit in the `gaps'
left by all programs. If a program asks for more memory than a gap provides the
request must be refused.\\

As memory is not mediated by the operating system but accessed directly by
programs a solution to this issue must necessarily be implemented in
hardware. The solution is \emph{virtual memory} -- a mechanism where the
operating system is able to instruct a \emph{Memory Management Unit (MMU)} to
map `virtual' addresses to `physical' ones.\\

\section{Page tables}
\index{page tables}
Keeping a track of memory raises a practical issue -- if we need metadata to
keep track of things such as whether a certain part of memory is allocated or
not, then we can't keep track of things at a byte granularity or we'd end up in
the absurd situation where each byte of memory requires (at least) a byte to
describe it.\\

We therefore have to divide memory up into blocks. These blocks are called
\emph{pages}.\\

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum
dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident,
sunt in culpa qui officia deserunt mollit anim id est laborum.

\input{figures/page-table.tex}

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum
dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident,
sunt in culpa qui officia deserunt mollit anim id est laborum.
